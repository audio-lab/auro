var Ct=Object.defineProperty;var wt=(e,t)=>{for(var r in t)Ct(e,r,{get:t[r],enumerable:!0})};var C,k,$e=e=>(C=0,k=e,e=F(),k[C]?J():e||""),J=(e="Bad syntax",t=k.slice(0,C).split(`
`),r=t.pop())=>{let i=k.slice(C-108,C).split(`
`).pop(),l=k.slice(C,C+108).split(`
`).shift();throw EvalError(`${e} at ${t.length}:${r.length} \`${C>=108?"\u2026":""}${i}\u2503${l}\``,"font-weight: bold")},G=(e,t=C,r)=>{for(;r=e(k.charCodeAt(C));)C+=r;return k.slice(t,C)},ee=(e=1,t=C)=>(C+=e,k.slice(t,C)),F=(e=0,t)=>{let r,i,l,n;for(;(r=vt())&&(l=((n=Z[r])&&n(i,e))??(!i&&G($e.id)));)i=l;return t&&(r==t?C++:J()),i},vt=e=>{for(;(e=k.charCodeAt(C))<=32;)C++;return e},st=$e.id=e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||e==36||e==95||e>=192&&e!=215&&e!=247,Z=[],D=(e,t=32,r,i=e.charCodeAt(0),l=e.length,n=Z[i],o=e.toUpperCase()!==e)=>Z[i]=(a,d,x,M=C)=>(x?e==x:(l<2||k.substr(C,l)==e)&&(x=e))&&d<t&&!(o&&$e.id(k.charCodeAt(C+l)))&&(C+=l,r(a)||(C=M,!n&&J()))||n?.(a,d,x),m=(e,t,r=!1)=>D(e,t,(i,l)=>i&&(l=F(t-(r?.5:0)))&&[e,i,l]),ie=(e,t,r)=>D(e,t,i=>r?i&&[e,i]:!i&&(i=F(t-.5))&&[e,i]),ye=(e,t,r)=>{D(e,t,(i,l)=>(l=F(t),i?.[0]!==e&&(i=[e,i]),l?.[0]===e?i.push(...l.slice(1)):i.push(l),i))},Me=(e,t)=>D(e[0],t,r=>!r&&[e,F(0,e.charCodeAt(1))]),qe=(e,t)=>D(e[0],t,r=>r&&[e[0],r,F(0,e.charCodeAt(1))]),Be=$e;var $="int",y="flt",Fe=Be;var bt=32,ut=39,at=34,pt=46,Rt=92;var pe=48,Pt=49,It=56,_t=57,Nt=65,Ot=70,kt=97,Ut=102,Tt=69,St=101,Lt=98,Mt=111,qt=120,Bt=58;var Ft=35;var zt=1,Ae=4,Dt=6,Ee=8,jt=8,ne=8.25,Gt=11,Ht=12,Kt=13,Qt=14,Xt=15,xt=16,Ce=17,te=18,oe=19,gt=20,ct=22,we=23,Yt=24,Y=26,ze=27,_e=28,Wt=Be.id=e=>st(e)||e===Ft,le=e=>e>=pe&&e<=_t,De=e=>{e&&J();let t,r=$,i,l;return t=G(n=>n===pe||n===qt||n===Mt||n===Lt),t==="0x"?t=parseInt(G(n=>le(n)||n>=kt&&n<=Ut||n>=Nt&&n<=Ot),16):t==="0o"?t=parseInt(G(n=>n>=pe&&n<=It),8):t==="0b"?t=parseInt(G(n=>n===Pt||n===pe),2):(t+=G(le),k.charCodeAt(C)===pt&&le(k.charCodeAt(C+1))&&(t+=ee()+G(le),r=y),(k.charCodeAt(C)===Tt||k.charCodeAt(C)===St)&&(t+=ee(2)+G(le)),t=+t,t!=t&&J(`Bad number ${t}`)),l=[r,t],(i=G(n=>!le(n)&&Wt(n)))&&l.push(i),le(k.charCodeAt(C))&&l.push(De()),l};Z[pt]=e=>!e&&De();for(let e=pe;e<=_t;e++)Z[e]=De;var Vt={n:`
`,r:"\r",t:"	",b:"\b",f:"\f",v:"\v"},mt=e=>(t,r,i="")=>{for(t&&J("Unexpected string"),ee();r=k.charCodeAt(C),r-e;)r===Rt?(ee(),r=ee(),i+=Vt[r]||r):i+=ee();return ee()||J("Bad string"),[,i]};Z[at]=mt(at);Z[ut]=mt(ut);qe("()",ze);qe("[]",ze);Me("()",ze);Me("[]",_e);ye(",",Dt,!0);ye(";",zt,!0);m("*",we);m("/",we);m("%",we);ie("*",Y);m("+",gt);m("-",gt);ie("+",Y);ie("-",Y);D("++",Y,e=>e?["++",e]:["+=",F(Y-1),[$,1]]);D("--",Y,e=>e?["--",e]:["-=",F(Y-1),[$,1]]);ie("~",Y);m("~",oe);m("|",Kt);m("&",Xt);m("^",Qt);m("||",Gt);m("&&",Ht);ie("!",Y);m("=",ne,!0);m("*=",ne,!0);m("/=",ne,!0);m("%=",ne,!0);m("+=",ne,!0);m("-=",ne,!0);m("~=",ne,!0);m("==",xt);m("!=",xt);m(">",Ce);m("<",Ce);m(">=",Ce);m("<=",Ce);m(">>",te);m("<<",te);m(">>>",te);m("<<<",te);m(">>=",te);m("<<=",te);m(">>>=",te);m("<<<=",te);m("**",Yt,!0);m("%%",we,!0);m("~<",oe);m("~/",oe);m("~*",oe);m("~//",oe);m("~**",oe);ye("|>",jt);D("..",ct,e=>["..",e,F(ct)]);D("./",_e,(e,t)=>!e&&(t=F(Ae),t?["./",t]:["./"]));D("../",_e,(e,t)=>!e&&(t=F(Ae),t?["../",t]:["../"]));D("/",_e,(e,t)=>!e&&(t=F(Ae),t?["/",t]:["/"]));ie("^",Ae);m("?",Ee,!0);D("?",Ee,(e,t,r)=>e&&(t=F(Ee-.5))&&G(i=>i===Bt)&&(r=F(Ee-.5),["?:",e,t,r]));D(";;",_e,(e,t)=>(G(r=>r>=bt),e||F(t)||[]));var se={};wt(se,{f32:()=>je,f64:()=>Ge,i16:()=>Jt,i32:()=>W,i64:()=>ve,i8:()=>Zt,uleb:()=>E});var E=(e,t=[])=>{typeof e=="string"&&(e=W.parse(e));let r=e&127;return e=e>>>7,e===0?(t.push(r),t):(t.push(r|128),E(e,t))};function W(e,t=[]){for(typeof e=="string"&&(e=W.parse(e));;){let r=Number(e&127);if(e>>=7,e===0&&!(r&64)||e===-1&&r&64){t.push(r);break}t.push(r|128)}return t}var Zt=W,Jt=W;W.parse=e=>parseInt(e.replaceAll("_",""));function ve(e,t=[]){for(typeof e=="string"&&(e=ve.parse(e));;){let r=Number(e&0x7Fn);if(e>>=7n,e===0n&&!(r&64)||e===-1n&&r&64){t.push(r);break}t.push(r|128)}return t}ve.parse=e=>(e=e.replaceAll("_",""),e=e[0]==="-"?-BigInt(e.slice(1)):BigInt(e),U.setBigInt64(0,e),e=U.getBigInt64(0));var U=new DataView(new BigInt64Array(1).buffer),er=2147483648,tr=2139095040;function je(e,t,r){return~(r=e.indexOf("nan:"))?(t=W.parse(e.slice(r+4)),t|=tr,e[0]==="-"&&(t|=er),U.setInt32(0,t)):(t=typeof e=="string"?je.parse(e):e,U.setFloat32(0,t)),[U.getUint8(3),U.getUint8(2),U.getUint8(1),U.getUint8(0)]}var rr=0x8000000000000000n,ir=0x7ff0000000000000n;function Ge(e,t,r){return~(r=e.indexOf("nan:"))?(t=ve.parse(e.slice(r+4)),t|=ir,e[0]==="-"&&(t|=rr),U.setBigInt64(0,t)):(t=typeof e=="string"?Ge.parse(e):e,U.setFloat64(0,t)),[U.getUint8(7),U.getUint8(6),U.getUint8(5),U.getUint8(4),U.getUint8(3),U.getUint8(2),U.getUint8(1),U.getUint8(0)]}je.parse=Ge.parse=e=>{if(e.includes("nan"))return e[0]==="-"?NaN:NaN;if(e.includes("inf"))return e[0]==="-"?-1/0:1/0;if(e=e.replaceAll("_",""),e.includes("0x")){let[t,r]=e.split(/p/i),[i,l]=t.split("."),n=i[0]==="-"?-1:1;return t=parseInt(i)*n+(l?parseInt(l,16)/16**l.length:0),n*(r?t*2**parseInt(r,10):t)}return parseFloat(e)};var be=["unreachable","nop","block","loop","if","else","then",,,,,"end","br","br_if","br_table","return","call","call_indirect",,,,,,,,,"drop","select",,,,,"local.get","local.set","local.tee","global.get","global.set",,,,"i32.load","i64.load","f32.load","f64.load","i32.load8_s","i32.load8_u","i32.load16_s","i32.load16_u","i64.load8_s","i64.load8_u","i64.load16_s","i64.load16_u","i64.load32_s","i64.load32_u","i32.store","i64.store","f32.store","f64.store","i32.store8","i32.store16","i64.store8","i64.store16","i64.store32","memory.size","memory.grow","i32.const","i64.const","f32.const","f64.const","i32.eqz","i32.eq","i32.ne","i32.lt_s","i32.lt_u","i32.gt_s","i32.gt_u","i32.le_s","i32.le_u","i32.ge_s","i32.ge_u","i64.eqz","i64.eq","i64.ne","i64.lt_s","i64.lt_u","i64.gt_s","i64.gt_u","i64.le_s","i64.le_u","i64.ge_s","i64.ge_u","f32.eq","f32.ne","f32.lt","f32.gt","f32.le","f32.ge","f64.eq","f64.ne","f64.lt","f64.gt","f64.le","f64.ge","i32.clz","i32.ctz","i32.popcnt","i32.add","i32.sub","i32.mul","i32.div_s","i32.div_u","i32.rem_s","i32.rem_u","i32.and","i32.or","i32.xor","i32.shl","i32.shr_s","i32.shr_u","i32.rotl","i32.rotr","i64.clz","i64.ctz","i64.popcnt","i64.add","i64.sub","i64.mul","i64.div_s","i64.div_u","i64.rem_s","i64.rem_u","i64.and","i64.or","i64.xor","i64.shl","i64.shr_s","i64.shr_u","i64.rotl","i64.rotr","f32.abs","f32.neg","f32.ceil","f32.floor","f32.trunc","f32.nearest","f32.sqrt","f32.add","f32.sub","f32.mul","f32.div","f32.min","f32.max","f32.copysign","f64.abs","f64.neg","f64.ceil","f64.floor","f64.trunc","f64.nearest","f64.sqrt","f64.add","f64.sub","f64.mul","f64.div","f64.min","f64.max","f64.copysign","i32.wrap_i64","i32.trunc_f32_s","i32.trunc_f32_u","i32.trunc_f64_s","i32.trunc_f64_u","i64.extend_i32_s","i64.extend_i32_u","i64.trunc_f32_s","i64.trunc_f32_u","i64.trunc_f64_s","i64.trunc_f64_u","f32.convert_i32_s","f32.convert_i32_u","f32.convert_i64_s","f32.convert_i64_u","f32.demote_f64","f64.convert_i32_s","f64.convert_i32_u","f64.convert_i64_s","f64.convert_i64_u","f64.promote_f32","i32.reinterpret_f32","i64.reinterpret_f64","f32.reinterpret_i32","f64.reinterpret_i64",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"memory.init","data.drop","memory.copy","memory.fill","table.init","elem.drop","table.copy",,"v128.load","v128.load8x8_s","v128.load8x8_u","v128.load16x4_s","v128.load16x4_u","v128.load32x2_s","v128.load32x2_u","v128.load8_splat","v128.load16_splat","v128.load32_splat","v128.load64_splat","v128.store","v128.const","i8x16.shuffle","i8x16.swizzle","i8x16.splat","i16x8.splat","i32x4.splat","i64x2.splat","f32x4.splat","f64x2.splat","i8x16.extract_lane_s","i8x16.extract_lane_u","i8x16.replace_lane","i16x8.extract_lane_s","i16x8.extract_lane_u","i16x8.replace_lane","i32x4.extract_lane","i32x4.replace_lane","i64x2.extract_lane","i64x2.replace_lane","f32x4.extract_lane","f32x4.replace_lane","f64x2.extract_lane","f64x2.replace_lane","i8x16.eq","i8x16.ne","i8x16.lt_s","i8x16.lt_u","i8x16.gt_s","i8x16.gt_u","i8x16.le_s","i8x16.le_u","i8x16.ge_s","i8x16.ge_u","i16x8.eq","i16x8.ne","i16x8.lt_s","i16x8.lt_u","i16x8.gt_s","i16x8.gt_u","i16x8.le_s","i16x8.le_u","i16x8.ge_s","i16x8.ge_u","i32x4.eq","i32x4.ne","i32x4.lt_s","i32x4.lt_u","i32x4.gt_s","i32x4.gt_u","i32x4.le_s","i32x4.le_u","i32x4.ge_s","i32x4.ge_u","f32x4.eq","f32x4.ne","f32x4.lt","f32x4.gt","f32x4.le","f32x4.ge","f64x2.eq","f64x2.ne","f64x2.lt","f64x2.gt","f64x2.le","f64x2.ge","v128.not","v128.and","v128.andnot","v128.or","v128.xor","v128.bitselect","v128.any_true","v128.load8_lane","v128.load16_lane","v128.load32_lane","v128.load64_lane","v128.store8_lane","v128.store16_lane","v128.store32_lane","v128.store64_lane","v128.load32_zero","v128.load64_zero","f32x4.demote_f64x2_zero","f64x2.promote_low_f32x4","i8x16.abs","i8x16.neg","i8x16.popcnt","i8x16.all_true","i8x16.bitmask","i8x16.narrow_i16x8_s","i8x16.narrow_i16x8_u","f32x4.ceil","f32x4.floor","f32x4.trunc","f32x4.nearest","i8x16.shl","i8x16.shr_s","i8x16.shr_u","i8x16.add","i8x16.add_sat_s","i8x16.add_sat_u","i8x16.sub","i8x16.sub_sat_s","i8x16.sub_sat_u","f64x2.ceil","f64x2.floor","i8x16.min_s","i8x16.min_u","i8x16.max_s","i8x16.max_u","f64x2.trunc","i8x16.avgr_u","i16x8.extadd_pairwise_i8x16_s","i16x8.extadd_pairwise_i8x16_u","i32x4.extadd_pairwise_i16x8_s","i32x4.extadd_pairwise_i16x8_u","i16x8.abs","i16x8.neg","i16x8.q15mulr_sat_s","i16x8.all_true","i16x8.bitmask","i16x8.narrow_i32x4_s","i16x8.narrow_i32x4_u","i16x8.extend_low_i8x16_s","i16x8.extend_high_i8x16_s","i16x8.extend_low_i8x16_u","i16x8.extend_high_i8x16_u","i16x8.shl","i16x8.shr_s","i16x8.shr_u","i16x8.add","i16x8.add_sat_s","i16x8.add_sat_u","i16x8.sub","i16x8.sub_sat_s","i16x8.sub_sat_u","f64x2.nearest","i16x8.mul","i16x8.min_s","i16x8.min_u","i16x8.max_s","i16x8.max_u",,"i16x8.avgr_u","i16x8.extmul_low_i8x16_s","i16x8.extmul_high_i8x16_s","i16x8.extmul_low_i8x16_u","i16x8.extmul_high_i8x16_u","i32x4.abs","i32x4.neg",,"i32x4.all_true","i32x4.bitmask",,,"i32x4.extend_low_i16x8_s","i32x4.extend_high_i16x8_s","i32x4.extend_low_i16x8_u","i32x4.extend_high_i16x8_u","i32x4.shl","i32x4.shr_s","i32x4.shr_u","i32x4.add",,,"i32x4.sub",,,,"i32x4.mul","i32x4.min_s","i32x4.min_u","i32x4.max_s","i32x4.max_u","i32x4.dot_i16x8_s",,"i32x4.extmul_low_i16x8_s","i32x4.extmul_high_i16x8_s","i32x4.extmul_low_i16x8_u","i32x4.extmul_high_i16x8_u","i64x2.abs","i64x2.neg",,"i64x2.all_true","i64x2.bitmask",,,"i64x2.extend_low_i32x4_s","i64x2.extend_high_i32x4_s","i64x2.extend_low_i32x4_u","i64x2.extend_high_i32x4_u","i64x2.shl","i64x2.shr_s","i64x2.shr_u","i64x2.add",,,"i64x2.sub",,,,"i64x2.mul","i64x2.eq","i64x2.ne","i64x2.lt_s","i64x2.gt_s","i64x2.le_s","i64x2.ge_s","i64x2.extmul_low_i32x4_s","i64x2.extmul_high_i32x4_s","i64x2.extmul_low_i32x4_u","i64x2.extmul_high_i32x4_u","f32x4.abs","f32x4.neg",,"f32x4.sqrt","f32x4.add","f32x4.sub","f32x4.mul","f32x4.div","f32x4.min","f32x4.max","f32x4.pmin","f32x4.pmax","f64x2.abs","f64x2.neg",,"f64x2.sqrt","f64x2.add","f64x2.sub","f64x2.mul","f64x2.div","f64x2.min","f64x2.max","f64x2.pmin","f64x2.pmax","i32x4.trunc_sat_f32x4_s","i32x4.trunc_sat_f32x4_u","f32x4.convert_i32x4_s","f32x4.convert_i32x4_u","i32x4.trunc_sat_f64x2_s_zero","i32x4.trunc_sat_f64x2_u_zero","f64x2.convert_low_i32x4_s","f64x2.convert_low_i32x4_u"],dt={type:1,import:2,func:3,table:4,memory:5,global:6,export:7,start:8,elem:9,code:10,data:11},X={i32:127,i64:126,f32:125,f64:124,void:64,func:96,funcref:112,v128:123},He={func:0,table:1,memory:2,global:3},Re={"i32.load":4,"i64.load":8,"f32.load":4,"f64.load":8,"i32.load8_s":1,"i32.load8_u":1,"i32.load16_s":2,"i32.load16_u":2,"i64.load8_s":1,"i64.load8_u":1,"i64.load16_s":2,"i64.load16_u":2,"i64.load32_s":4,"i64.load32_u":4,"i32.store":4,"i64.store":8,"f32.store":4,"f64.store":8,"i32.store8":1,"i32.store16":2,"i64.store8":1,"i64.store16":2,"i64.store32":4,"v128.load":16,"v128.load8x8_s":8,"v128.load8x8_u":8,"v128.load16x4_s":8,"v128.load16x4_u":8,"v128.load32x2_s":8,"v128.load32x2_u":8,"v128.load8_splat":1,"v128.load16_splat":2,"v128.load32_splat":4,"v128.load64_splat":8,"v128.store":16,"v128.load":16,"v128.load8_lane":1,"v128.load16_lane":2,"v128.load32_lane":4,"v128.load64_lane":8,"v128.store8_lane":1,"v128.store16_lane":2,"v128.store32_lane":4,"v128.store64_lane":8,"v128.load32_zero":4,"v128.load64_zero":8};var xe=e=>{let t=0,r=[],i="",l=()=>i&&(r.push(i),i=""),n=()=>{for(let o,a;t<e.length;)if(o=e.charCodeAt(t),o===34)l(),i=e.slice(t++,t=e.indexOf('"',t)+1),l();else if(o===40)e.charCodeAt(t+1)===59?t=e.indexOf(";)",t)+2:(l(),t++,(a=r).push(r=[]),n(),r=a);else if(o===59)t=e.indexOf(`
`,t)+1||e.length;else if(o<=32)l(),t++;else{if(o===41)return l(),t++;i+=e[t++]}l()};return n(),r.length>1?r:r[0]};var ge=e=>{throw Error(e)};var Ye=e=>{typeof e=="string"&&(e=xe(e));let t={type:[],import:[],func:[],table:[],memory:[],global:[],export:[],start:[],elem:[],code:[],data:[]},r=[0,97,115,109,1,0,0,0];typeof e[0]=="string"&&e[0]!=="module"&&(e=[e]),e=e.map(n=>{if(n[2]?.[0]==="import"){let[o,a,d,...x]=n;return[...d,[o,a,...x]]}else if(n[1]?.[0]==="import"){let[o,a,...d]=n;return[...a,[o,...d]]}return n});let i=["type","import","table","memory","global","func","export","start","elem","data"],l=[];for(let n of i){let o=[];for(let a of e)a[0]===n?l.push(Xe[n](a,t)):o.push(a);e=o}for(let n of l)n?.();for(let n in t){let o=t[n];if(o.importc&&(o=o.slice(o.importc)),!o.length)continue;let a=dt[n],d=[];a!==8&&d.push(o.length);for(let x of o)d.push(...x);r.push(a,...E(d.length),...d)}return new Uint8Array(r)},Xe={type([,e,[t,...r]],i){t!=="func"&&ge(`Unknown type kind '${t}'`);let[l]=Ie(r,i);e&&(i.type[e]=l)},func([,...e],t){let r=[],i=[];e[0]?.[0]==="$"&&(t.func[e.shift()]=t.func.length),e[0]?.[0]==="export"&&Xe.export([...e.shift(),["func",t.func.length]],t);let[l,n,o]=Ie(e,t);for(t.func.push([l]);e[0]?.[0]==="local";){let[,...x]=e.shift(),M;x[0][0]==="$"&&(n[M=x.shift()]?ge("Ambiguous name "+M):r[M]=n.length+r.length),r.push(...x.map(B=>X[B]))}let a=r.reduce((x,M)=>(M==x[x.length-1]?x[x.length-2]++:x.push(1,M),x),[]),d=(x,M=[])=>{if(!x?.length)return M;let B=x.shift(),_,c=x,g,K,he;if((he=Array.isArray(B))?(c=[...B],_=be.indexOf(B=c.shift())):_=be.indexOf(B),_>=268){if(_-=268,g=[253,...E(_)],_<=11){let v=Qe(c);g.push(Math.log2(v.align??Re[B]),...E(v.offset??0))}else if(_>=84&&_<=93){let v=Qe(c);g.push(Math.log2(v.align??Re[B]),...E(v.offset??0)),_<=91&&g.push(...E(c.shift()))}else if(_===13)for(let v=0;v<16;v++)g.push(W.parse(c.shift()));else _===12?(c.unshift(B),g=ue(c,t)):_>=21&&_<=34&&g.push(...E(c.shift()));_=null}else if(_>=252)g=[252,...E(_-=252)],_&2?g.push(0):g.push(...E(c.shift())),_&1||g.push(0),_=null;else if(!(_>=69))if(_>=40&&_<=62){let v=Qe(c);g=[Math.log2(v.align??Re[B]),...E(v.offset??0)]}else if(_>=65&&_<=68)g=se[B.split(".")[0]](c.shift());else if(_>=32&&_<=34)g=E(c[0]?.[0]==="$"?n[K=c.shift()]||r[K]:c.shift());else if(_==35||_==36)g=E(c[0]?.[0]==="$"?t.global[c.shift()]:c.shift());else if(_==16){let v=c.shift();g=E(K=v[0]==="$"?t.func[v]??ge("Unknown function `"+v+"`"):v)}else if(_==17){let v=c.shift()[1];v=v[0]==="$"?t.type[v]:v,g=E(v),g.push(0)}else if(_==63||_==64)g=[0];else if(_===2||_===3||_===4){if(i.push(_),_<4&&c[0]?.[0]==="$"&&(i[c.shift()]=i.length),c[0]?.[0]==="result"&&c[0].length<3){let[,v]=c.shift();g=[X[v]]}else if(c[0]?.[0]==="result"||c[0]?.[0]==="param"){let[v]=Ie(c,t);g=[v]}else g=[X.void];if(he)if(x.unshift("end"),_<4)for(;c.length;)x.unshift(c.pop());else c.length<3||(x.unshift(c.pop()),x[0][0]!=="else"?x.unshift("else"):x[0].length<2&&x.shift()),x.unshift(c.pop())}else if(_===5){if(he)for(;c.length;)x.unshift(c.pop())}else if(_===6)_=null;else if(_==11)i.pop();else if(_==12||_==13)g=E(c[0]?.[0]==="$"?i.length-i[c.shift()]:c.shift());else if(_==14){for(g=[];!Array.isArray(c[0]);)K=c.shift(),g.push(...E(K[0][0]==="$"?i.length-i[K]:K));g.unshift(...E(g.length-1))}else _<0&&ge(`Unknown instruction \`${B}\``);if(he)for(;c.length;)d(c,M);_&&M.push(_),g&&M.push(...g)};return()=>{let x=[];for(;e.length;)d(e,x);t.code.push([...E(x.length+2+a.length),...E(a.length>>1),...a,...x,11])}},memory([,...e],t){e[0][0]==="$"&&(t.memory[e.shift()]=t.memory.length),e[0][0]==="export"&&Xe.export([...e.shift(),["memory",t.memory.length]],t),t.memory.push(Ke(e))},global([,...e],t){let r=e[0][0]==="$"&&e.shift();r&&(t.global[r]=t.global.length);let[i,[...l]]=e,n=i[0]==="mut"?1:0;t.global.push([X[n?i[1]:i],n,...ue(l,t),11])},table([,...e],t){let r=e[0][0]==="$"&&e.shift();r&&(t.table[r]=t.table.length);let i=Ke(e);t.table.push([X[e.pop()],...i])},elem([,[...e],...t],r){r.elem.push([0,...ue(e,r),11,...E(t.length),...t.flatMap(l=>E(l[0]==="$"?r.func[l]:l))])},export([,e,[t,r]],i){r[0]==="$"&&(r=i[t][r]),i.export.push([...Pe(e),He[t],...E(r)])},import([,e,t,r],i){let l,[n,...o]=r,a=o[0]?.[0]==="$"&&o.shift();if(n==="func"){a&&(i.func[a]=i.func.length);let[d]=Ie(o,i);i.func.push(l=E(d)),i.func.importc=(i.func.importc||0)+1}else if(n==="memory")a&&(i.memory[a]=i.memory.length),l=Ke(o);else if(n==="global"){a&&(i.global[a]=i.global.length);let[d]=o,x=d[0]==="mut"?1:0;l=[X[x?d[1]:d],x],i.global.push(l),i.global.importc=(i.global.importc||0)+1}else throw Error("Unimplemented "+n);i.import.push([...Pe(e),...Pe(t),He[n],...l])},data([,...e],t){let r,i;e[0]?.[0]==="offset"&&([,r]=e.shift()),e[0]?.[0]==="memory"&&([,i]=e.shift()),e[0]?.[0]==="offset"&&([,r]=e.shift()),!r&&!i&&(r=e.shift()),r||(r=["i32.const",0]),t.data.push([0,...ue([...r],t),11,...Pe(e.map(l=>l[0]==='"'?l.slice(1,-1):l).join(""))])},start([,e],t){t.start.length||t.start.push([e[0]==="$"?t.func[e]:e])}},ue=(e,t)=>{let r=e.shift(),[i,l]=r.split(".");return i==="global"?[35,...E(e[0][0]==="$"?t.global[e[0]]:e[0])]:i==="v128"?[253,12,...lr(e)]:l==="const"?[65+["i32","i64","f32","f64"].indexOf(i),...se[i](e[0])]:[...ue(e.shift(),t),...ue(e.shift(),t),be.indexOf(r)]},lr=e=>{let[t,r]=e.shift().split("x"),i=t.slice(1)>>>3;if(r=+r,t[0]==="i"){let n=r===16?new Uint8Array(16):r===8?new Uint16Array(8):r===4?new Uint32Array(4):new BigInt64Array(2);for(let o=0;o<r;o++)n[o]=se[t].parse(e.shift());return new Uint8Array(n.buffer)}let l=new Uint8Array(16);for(let n=0;n<r;n++)l.set(se[t](e.shift()),n*i);return l},nr={n:10,r:13,t:9,v:1,"\\":92},Pe=e=>{e=e[0]==='"'?e.slice(1,-1):e;let t=[],r=0,i,l=92;for(;r<e.length;)i=e.charCodeAt(r++),t.push(i===l?nr[e[r++]]||parseInt(e.slice(r-1,++r),16):i);return t.unshift(...E(t.length)),t},Ke=([e,t,r])=>isNaN(parseInt(t))?[0,...E(e)]:[r==="shared"?3:1,...E(e),...E(t)],Ie=(e,t)=>{let r=[],i=[],l,n;for(;e[0]?.[0]==="param";){let[,...o]=e.shift();o[0]?.[0]==="$"&&(r[o.shift()]=r.length),r.push(...o.map(a=>X[a]))}return e[0]?.[0]==="result"&&(i=e.shift().slice(1).map(o=>X[o])),n=[X.func,...E(r.length),...r,...E(i.length),...i],l=t.type.findIndex(o=>o.every((a,d)=>a===n[d])),l<0&&(l=t.type.push(n)-1),[l,r,i]},Qe=e=>{let t={},r;for(;e[0]?.includes("=");)r=e.shift().split("="),t[r[0]]=Number(r[1]);return t};var We="",Ne=`
`;function Oe(e,t={}){return typeof e=="string"&&(e=xe(e)),{indent:We="  ",newline:Ne=`
`}=t,We||="",Ne||="",typeof e[0]=="string"?Ve(e):e.map(r=>Ve(r)).join(Ne)}var ht=["param","local","drop","f32.const","f64.const","i32.const","i64.const","local.get","global.get","memory.size","result","export","unreachable","nop"];function Ve(e,t=0){if(!Array.isArray(e))return e+"";let r=e[0];for(let i=1;i<e.length;i++)Array.isArray(e[i])?(ht.includes(e[i][0])&&(!Array.isArray(e[i-1])||ht.includes(e[i-1][0]))?Array.isArray(e[i-1])||(r+=" "):(r+=Ne,e[i]&&(r+=We.repeat(t+1))),r+=Ve(e[i],t+1)):(r+=" ",r+=e[i]);return`(${r})`}function A(e){throw Error(e||"Bad syntax")}function Ze(e){return Oe(e+"",{indent:"  ",newline:`
`})}function ae(e,t=new Set){if(e?.ids)return e.ids;if(typeof e=="string")t.add(e);else if(Array.isArray(e)){if(e[0]===$||e[0]===y)return;if(e[0]==="="&&e[1][0]==="(")return t.add(e[1][1]),t;for(let r=1;r<e.length;r++)ae(e[r],t);e.ids=t}return t}function $t(e,t){for(let r of e)if(t.has(r))return!0;return!1}function ke(e){if(typeof e=="string")return e;let[t,r,...i]=e;return t===$||t===y?r+i.join(""):`${ke(r)} ${t} ${i.length?ke(i[0]):""}`}function yt(e){let t="";for(let r of e){let i=String.fromCharCode(r);i==='"'||i==="\\"?t+="\\"+i:r>=32&&r<=126?t+=i:t+=`\\${r.toString(16).padStart(2,"0")}`}return t}var me,Et;function Ue(e){Et={units:me},me={};let t=u(e);return{units:me}=Et,t}function u(e){return Array.isArray(e)&&u[e[0]]?u[e[0]](e):e}function Je(e,t,r){return t&&(e=u(["*",[y,e],me[t]||A(`Unknown unit \`${t}\``)])),r&&(e=u(["+",e,Je(...r.slice(1))])),e}Object.assign(u,{[y]([,e,t,r]){return t?Je(e,t,r):[y,e]},[$]([,e,t,r]){return t?Je(e,t,r):[$,e]},";"([,...e]){return[";",...e.filter((t,r)=>!r||t).map(t=>u(t))]},","(e){return e.flatMap((t,r)=>!r||!t?[t]:(t=u(t),[t]))},"./"([,e]){return["./",u(e)]},"../"([,e]){return["../",u(e)]},"()"([,e]){if(e=u(e),!(!e||!e.length))return e[0]==="()"||typeof e[1]=="number"||e[1]===".."||e[0]===",",e},"("([,e,t]){return t=t?t[0]===","?t:[",",t]:[,],["(",e,t]},"[]"([,e]){return e=u(e),e=e?e[0]===","?e:[",",e]:[,],e=e.flatMap((t,r)=>{if(!r)return[t];if(t[0]===".."&&typeof t[1][1]=="number"&&typeof t[2][1]=="number"&&Math.abs(t[2][1]-t[1][1])<108){let i=t[1][1],l=t[2][1],n=1,o=[];if(i===-1/0)for(let a=0;a<l;a+=n)o.push([y,0]);else if(i<l)for(let a=i;a<l;a+=n)o.push([y,a]);else for(let a=i;a>l;a-=n)o.push([y,a]);return o}return[t]}),["[]",e]},".."([,e,t]){return!e&&!t?["..",[y,-1/0],[y,1/0]]:e?t?(e=u(e),t=u(t),["..",e,t]):["..",u(e),[y,1/0]]:["..",[y,-1/0],u(t)]},"|>"([,e,t]){return e=u(e),t=u(t),["|>",e,t]},"["([,e,t]){return e=u(e),t?(t=u(t),w("[",e,t)||["[",e,t]):["[",e]},"="([,e,t]){if(t=u(t),e[0]==="("){t=t?t[0]===";"?t:[";",t]:[";"];let[,r,i]=e;return i=i?i[0]===","?i:[",",i]:[,],["=",["(",r,i],t]}if((e[0]===$||e[0]===y)&&e[2]){let[,r,i]=e;me[i]=u(["/",t,[y,r]]);return}if(e[0]==="*")return["=",e,t];if(e=u(e),e[0]===","&&$t(ae(e),ae(t))){let r=e.length-1;return[";",w("=",[",",...Array.from({length:r},(i,l)=>`t:${l}`)],t),w("=",e,[",",...Array.from({length:r},(i,l)=>`t:${l}`)])]}if(e[0]==="[]"){let[,r,i]=e;i=u(i),e=["[]",r,i]}return w("=",e,t)||["=",e,t]},"+="([,e,t]){return u(["=",e,["+",e,t]])},"-="([,e,t]){return u(["=",e,["-",e,t]])},"*="([,e,t]){return u(["=",e,["*",e,t]])},"/="([,e,t]){return u(["=",e,["/",e,t]])},"%="([,e,t]){return u(["=",e,["%",e,t]])},"**="([,e,t]){return u(["=",e,["**",e,t]])},"~="([,e,t]){return u(["=",e,["~",e,t]])},"+"([,e,t]){return e=u(e),t=u(t),w("+",e,t)||(typeof t[1]=="number"&&typeof e[1]=="number"?[e[0]===$&&t[0]===$?$:y,e[1]+t[1]]:t[1]===0?e:e[1]===0?t:["+",e,t])},"-"([,e,t]){return t?(e=u(e),t=u(t),w("-",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[e[0]===$&&t[0]===$?$:y,e[1]-t[1]]:e[1]===0?["-",t]:t[1]===0?e:["-",e,t])):(e=u(e),typeof e[1]=="number"?[e[0],-e[1]]:["-",e])},"*"([,e,t]){return t?(e=u(e),t=u(t),w("*",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[y,e[1]*t[1]]:e[1]===0||t[1]===0?[y,0]:t[1]===1?e:e[1]===1?t:["*",e,t])):["*",u(e)]},"/"([,e,t]){return t?(e=u(e),t=u(t),w("/",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[y,e[1]/t[1]]:e[1]===0?[y,0]:t[1]===1?e:["/",e,t])):["/",u(e)]},"%"([,e,t]){return e=u(e),t=u(t),w("%",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[y,e[1]%t[1]]:["%",e,t])},"%%"([,e,t]){return e=u(e),t=u(t),w("%%",e,t)||["%%",e,t]},"**"([,e,t]){return e=u(e),t=u(t),w("**",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[y,e[1]**t[1]]:t[1]===0?[y,1]:e[1]===1?[y,1]:t[1]===1?e:t[1]===-1?["/",[y,1],t]:typeof t[1]=="number"&&t[1]<0?["/",[y,1],u(["**",e,[y,Math.abs(t[1])]])]:typeof e=="string"&&typeof t[1]=="number"&&t[1]%1===0&&t[1]<=3?Array(t[1]).fill(e).reduce((r,i)=>["*",i,r]):["**",e,t])},"//"([,e,t]){return e=u(e),t=u(t),w("//",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[y,Math.floor(e[1]/t[1])]:e[1]===0?[y,0]:t[1]===1?e:["//",e,t])},"!"([,e]){return e=u(e),w("!",e)||(typeof e[1]=="number"?[$,!e[1]]:["!",e])},"&"([,e,t]){return e=u(e),t=u(t),w("&",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[$,e[1]&t[1]]:e[1]===0||t[1]===0?[$,0]:["&",e,t])},"|"([,e,t]){return e=u(e),t=u(t),w("|",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[$,e[1]|t[1]]:["|",e,t])},"^"([,e,t]){return t?(e=u(e),t=u(t),w("^",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[$,e[1]^t[1]]:["^",e,t])):["^",u(e)]},"<<"([,e,t]){return e=u(e),t=u(t),w("<<",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[$,e[1]<<t[1]]:["<<",e,t])},">>"([,e,t]){return e=u(e),t=u(t),w(">>",e,t)||(typeof e[1]=="number"&&typeof t[1]=="number"?[$,e[1]>>t[1]]:[">>",e,t])},"~"([,e,t]){return t?(e=u(e),t=u(t),w("~",e,t)||["~",e,t]):(e=u(e),w("~",e)||(typeof e[1]=="number"?[$,~e[1]]:["~",e]))},">"([,e,t]){return e=u(e),t=u(t),w(">",e,t)||[">",e,t]},">="([,e,t]){return e=u(e),t=u(t),w(">=",e,t)||[">=",e,t]},"<"([,e,t]){return e=u(e),t=u(t),w("<",e,t)||["<",e,t]},"<="([,e,t]){return e=u(e),t=u(t),w("<=",e,t)||["<=",e,t]},"=="([,e,t]){return e=u(e),t=u(t),w("==",e,t)||["==",e,t]},"!="([,e,t]){return e=u(e),t=u(t),w("!=",e,t)||["!=",e,t]},"&&"([,e,t]){return e=u(e),t=u(t),w("&&",e,t)||(e[1]===0?e:t[1]===0||typeof e[1]=="number"&&e[1]?t:typeof t[1]=="number"&&t[1]?e:["&&",e,t])},"||"([,e,t]){return e=u(e),t=u(t),w("||",e,t)||(e[1]===0?t:t[1]===0?e:typeof e[1]=="number"&&e[1]?t:typeof t[1]=="number"&&t[1]?e:["||",e,t])},"?"([,e,t]){return e=u(e),t=u(t),w("?",e,t)||["?",e,t]},"?:"([,e,t,r]){return e=u(e),e[1]===0?u(r):typeof e[1]=="number"&&e[1]?u(t):["?:",e,u(t),u(r)]}});function w(e,t,r){if(!r){if(t[0]===","){let[,...i]=t;return[",",...i.map(l=>[e,u(l)])]}return}if(t[0]===","){let[,...i]=t;if(r[0]===","){let[,...l]=r;return i.length!==l.length&&A(`Mismatching number of elements in \`${e}\` operation`),[",",...Array.from({length:Math.max(i.length,l.length)},(n,o)=>[e,u(i[o]||l[o]),u(l[o]||i[o])])]}return r=u(r),[",",...i.map(l=>[e,u(l),r])]}if(r[0]===","){let[,...i]=r;return t=u(t),[",",...i.map(l=>[e,t,u(l)])]}}var fr={"i32.smax":"(func $i32.smax (param i32 i32) (result i32) (select (local.get 0) (local.get 1) (i32.ge_s (local.get 0) (local.get 1))))","i32.smin":"(func $i32.smin (param i32 i32) (result i32) (select (local.get 0) (local.get 1) (i32.le_s (local.get 0) (local.get 1))))","i32.dup":"(func $i32.dup (param i32) (result i32) (local.get 0)(local.get 0))","f64.isnan":"(func $f64.isnan (param f64) (result i32) (f64.ne (local.get 0) (local.get 0)))","f64.pow":"(func $f64.pow(param f64 f64)(result f64)(local f64 i64 i64 i64 f64 f64 f64 f64 f64 f64)(local.set 2(f64.const 0x1p+0))(block(br_if 0(f64.eq(local.get 1)(f64.const 0x0p+0)))(local.set 3(i64.const 0))(block(br_if 0(i64.gt_s(i64.reinterpret_f64(local.get 0))(i64.const -1)))(br_if 0(f64.ne(f64.nearest(local.get 1))(local.get 1)))(local.set 3(i64.shl(i64.extend_i32_u(f64.ne(f64.nearest(local.tee 2(f64.mul(local.get 1)(f64.const 0x1p-1))))(local.get 2)))(i64.const 63)))(local.set 0(f64.neg(local.get 0))))(local.set 2(f64.const 0x1p+0))(block(br_if 0(f64.eq(local.get 0)(f64.const 0x1p+0)))(block(br_if 0(f64.ne(local.get 0)(f64.const 0x0p+0)))(local.set 2(select(f64.const inf)(f64.const 0x0p+0)(i64.lt_s(i64.reinterpret_f64(local.get 1))(i64.const 0))))(br 1))(block(br_if 0(f64.ne(f64.abs(local.get 0))(f64.const inf)))(local.set 2(select(f64.const 0x0p+0)(f64.const inf)(i64.lt_s(i64.reinterpret_f64(local.get 1))(i64.const 0))))(br 1))(block(br_if 0(i64.ge_s(local.tee 4(i64.reinterpret_f64(local.get 0)))(i64.const 0)))(local.set 2(f64.const nan))(br 1))(block(br_if 0(f64.ne(f64.abs(local.get 1))(f64.const inf)))(local.set 2(select(f64.const inf)(f64.const 0x0p+0)(i32.eq(i32.wrap_i64(i64.shr_u(i64.reinterpret_f64(local.get 1))(i64.const 63)))(f64.lt(local.get 0)(f64.const 0x1p+0)))))(br 1))(block(br_if 0(i64.gt_u(local.get 4)(i64.const 4503599627370495)))(local.set 4(i64.sub(i64.shl(local.get 4)(local.tee 5(i64.add(i64.clz(local.get 4))(i64.const -11))))(i64.shl(local.get 5)(i64.const 52)))))(local.set 2(f64.const inf))(br_if 0(f64.gt(local.tee 1(f64.add(local.tee 10(f64.mul(local.tee 6(f64.reinterpret_i64(i64.and(i64.reinterpret_f64(local.get 1))(i64.const -4294967296))))(local.tee 0(f64.reinterpret_i64(i64.and(i64.reinterpret_f64(f64.add(f64.add(local.tee 7(f64.mul(local.tee 0(f64.reinterpret_i64(i64.and(i64.reinterpret_f64(f64.add(local.tee 11(f64.mul(local.tee 0(f64.reinterpret_i64(i64.and(i64.reinterpret_f64(local.tee 9(f64.div(local.tee 7(f64.add(f64.reinterpret_i64(i64.sub(local.get 4)(i64.and(local.tee 5(i64.add(local.get 4)(i64.const -4604544271217802189)))(i64.const -4503599627370496))))(f64.const -0x1p+0)))(local.tee 8(f64.add(local.get 7)(f64.const 0x1p+1))))))(i64.const -134217728))))(local.tee 0(f64.reinterpret_i64(i64.and(i64.reinterpret_f64(f64.add(f64.add(local.tee 10(f64.mul(local.get 0)(local.get 0)))(local.tee 8(f64.add(f64.mul(local.tee 7(f64.div(f64.sub(f64.sub(local.get 7)(f64.mul(local.get 0)(local.tee 11(f64.reinterpret_i64(i64.and(i64.reinterpret_f64(local.get 8))(i64.const -4294967296))))))(f64.mul(local.get 0)(f64.add(local.get 7)(f64.sub(f64.const 0x1p+1)(local.get 11)))))(local.get 8)))(f64.add(local.get 9)(local.get 0)))(f64.mul(f64.mul(local.tee 0(f64.mul(local.get 9)(local.get 9)))(local.get 0))(f64.add(f64.mul(f64.add(f64.mul(f64.add(f64.mul(f64.add(f64.mul(f64.add(f64.mul(f64.add(f64.mul(local.get 0)(f64.const 0x1.91a4911cbce5ap-3))(f64.const 0x1.97a897f8e6cap-3))(local.get 0))(f64.const 0x1.d8a9d6a7940bp-3))(local.get 0))(f64.const 0x1.1745bc213e72fp-2))(local.get 0))(f64.const 0x1.5555557cccac1p-2))(local.get 0))(f64.const 0x1.b6db6db6b8d5fp-2))(local.get 0))(f64.const 0x1.3333333333385p-1))))))(f64.const 0x1.8p+1)))(i64.const -67108864))))))(local.tee 9(f64.add(f64.mul(local.get 7)(local.get 0))(f64.mul(local.get 9)(f64.add(local.get 8)(f64.add(local.get 10)(f64.sub(f64.const 0x1.8p+1)(local.get 0)))))))))(i64.const -4294967296))))(f64.const 0x1.ec709dc4p-1)))(local.tee 9(f64.add(f64.mul(local.get 0)(f64.const -0x1.7f00a2d80faabp-35))(f64.mul(f64.add(local.get 9)(f64.sub(local.get 11)(local.get 0)))(f64.const 0x1.ec709dc3a03fdp-1)))))(local.tee 8(f64.convert_i64_s(i64.shr_s(local.get 5)(i64.const 52))))))(i64.const -2097152))))))(local.tee 0(f64.add(f64.mul(f64.sub(local.get 1)(local.get 6))(local.get 0))(f64.mul(f64.add(local.get 9)(f64.add(local.get 7)(f64.sub(local.get 8)(local.get 0))))(local.get 1))))))(f64.const 0x1p+10)))(local.set 9(f64.sub(local.get 1)(local.get 10)))(block(br_if 0(f64.ne(local.get 1)(f64.const 0x1p+10)))(br_if 1(f64.lt(local.get 9)(local.get 0))))(local.set 2(f64.const 0x0p+0))(br_if 0(f64.lt(local.get 1)(f64.const -0x1.0ccp+10)))(block(br_if 0(f64.ne(local.get 1)(f64.const -0x1.0ccp+10)))(br_if 1(f64.gt(local.get 9)(local.get 0))))(local.set 4(i64.reinterpret_f64(f64.add(f64.add(local.tee 8(f64.mul(local.tee 7(f64.reinterpret_i64(i64.and(i64.reinterpret_f64(local.tee 2(f64.sub(local.get 1)(local.tee 9(f64.nearest(local.get 1))))))(i64.const -4294967296))))(f64.const 0x1.62e42ffp-1)))(f64.add(local.tee 2(f64.add(f64.mul(local.get 2)(f64.const -0x1.718432a1b0e26p-35))(f64.mul(f64.add(local.get 0)(f64.sub(local.get 10)(f64.add(local.get 9)(local.get 7))))(f64.const 0x1.62e42ffp-1))))(f64.div(f64.mul(local.tee 0(f64.add(local.get 8)(local.get 2)))(local.tee 2(f64.sub(local.get 0)(f64.mul(local.tee 2(f64.mul(local.get 0)(local.get 0)))(f64.add(f64.mul(local.get 2)(f64.add(f64.mul(local.get 2)(f64.add(f64.mul(local.get 2)(f64.add(f64.mul(local.get 2)(f64.const 0x1.63f2a09c94b4cp-25))(f64.const -0x1.bbd53273e8fb7p-20)))(f64.const 0x1.1566ab5c2ba0dp-14)))(f64.const -0x1.6c16c16c0ac3cp-9)))(f64.const 0x1.5555555555553p-3))))))(f64.sub(f64.const 0x1p+1)(local.get 2)))))(f64.const 0x1p+0))))(block(block(br_if 0(i32.eqz(f64.lt(f64.abs(local.get 9))(f64.const 0x1p+63))))(local.set 5(i64.trunc_f64_s(local.get 9)))(br 1))(local.set 5(i64.const -9223372036854775808)))(local.set 2(select(f64.mul(f64.reinterpret_i64(i64.add(local.tee 4(i64.add(i64.shl(local.get 5)(i64.const 52))(local.get 4)))(i64.const 4593671619917905920)))(f64.const 0x1p-1020))(f64.reinterpret_i64(local.get 4))(f64.lt(local.get 1)(f64.const -0x1.fep+9)))))(local.set 2(f64.reinterpret_i64(i64.or(local.get 3)(i64.reinterpret_f64(local.get 2))))))(local.get 2))","i32.modwrap":`(func $i32.modwrap (param i32 i32) (result i32) (local $rem i32)
    (local.set $rem (i32.rem_s (local.get 0) (local.get 1)))
    (if (result i32) (i32.and (local.get $rem) (i32.const 0x80000000))
      (then (i32.add (local.get 1) (local.get $rem)))
      (else (local.get $rem)
    )
  ))`,"f64.modwrap":`(func $f64.modwrap (param f64 f64) (result f64) (local $rem f64)
    (local.set $rem (call $f64.rem (local.get 0) (local.get 1)))
    (if (result f64) (f64.lt (local.get $rem) (f64.const 0))
      (then (f64.add (local.get 1) (local.get $rem)))
      (else (local.get $rem))
    )
  )`,"f64.rem":`(func $f64.rem (param f64 f64) (result f64)
    (f64.sub (local.get 0) (f64.mul (f64.floor (f64.div (local.get 0) (local.get 1))) (local.get 1)))
  )`,malloc:`(func $malloc (param i32) (result i32) (local i32 i32)
(local.set 1 (global.get $__mem))
(global.set $__mem (i32.add (global.get $__mem) (local.get 0)))
(local.set 2 (i32.shl (memory.size) (i32.const 16)) )
(if (i32.ge_u (global.get $__mem) (local.get 2)) (then
(memory.grow (i32.add (i32.shr_u (i32.sub (global.get $__mem) (local.get 2))(i32.sub (i32.const 1)) (i32.const 16)) (i32.const 1)) )(drop)
))
(local.get 1)
)`,range:`
    (func $range.dsc (param i32 f64 f64 f64) (result i32)
      (loop
        (if (f64.gt (local.get 1)(local.get 2))
        (then
          (f64.store (local.get 0) (local.get 1))
          (local.set 0 (i32.add (local.get 0) (i32.const 8)))
          (local.set 1 (f64.sub (local.get 1) (local.get 3)))
          (br 1)
          )
        )
      )
      (local.get 0)
    )`,"arr.ref":`(func $arr.ref (param i32 i32) (result f64)
(f64.reinterpret_i64 (i64.or
(i64.reinterpret_f64 (f64.convert_i32_u (local.get 0)))
(i64.extend_i32_u (i32.and (i32.const 0x00ffffff) (local.get 1)))))
(return))`,"arr.adr":"(func $arr.adr (param f64) (result i32) (i32.trunc_f64_u (local.get 0)) (return))","arr.len":"(func $arr.len (param f64) (result i32) (i32.wrap_i64 (i64.and (i64.const 0x0000000000ffffff) (i64.reinterpret_f64 (local.get 0)))))","arr.set":`(func $arr.set (param f64 i32 f64) (result f64)
(if (i32.lt_s (local.get 1) (i32.const 0)) (then (local.set 1 (call $i32.modwrap (local.get 1) (call $arr.len (local.get 0))))))
(f64.store (i32.add (i32.trunc_f64_u (local.get 0)) (i32.shl (local.get 1) (i32.const 3))) (local.get 2))
(local.get 0)
(return))
`,"arr.tee":"(func $arr.tee (param f64 i32 f64) (result f64) (call $arr.set (local.get 0)(local.get 1)(local.get 2))(drop) (return (local.get 2)))","arr.get":`(func $arr.get (param f64 i32) (result f64)
(if (i32.lt_s (local.get 1) (i32.const 0)) (then (local.set 1 (call $i32.modwrap (local.get 1) (call $arr.len (local.get 0))))))
(f64.load (i32.add (i32.trunc_f64_u (local.get 0)) (i32.shl (local.get 1) (i32.const 3))))
)`,math:"(global pi f64 (f64.const 3.141592653589793))"},et=fr;var P={const:e=>f(`(i32.const ${e})`,"i32"),load:e=>f(`(i32.load ${e})`,"i32"),store:(e,t)=>f(`(i32.store ${e} ${t})`),add:(e,t)=>f(`(i32.add ${e} ${t})`,"i32"),sub:(e,t)=>f(`(i32.sub ${e} ${t})`,"i32"),eqz:e=>f(`(i32.eqz ${e})`,"i32")},H={const:e=>f(`(f64.const ${e})`,"f64"),load:e=>f(`(f64.load ${e})`,"f64"),store:(e,t)=>f(`(f64.store ${e} ${t})`),add:(e,t)=>f(`(f64.add ${e} ${t})`,"f64"),sub:(e,t)=>f(`(f64.sub ${e} ${t})`,"f64"),lt:(e,t)=>f(`(f64.lt ${e} ${t})`,"i32")};function tt(e,t,r){let i=t.type?`(result ${t.type.join(" ")})`:"";return f(`(if ${i} ${e} (then ${t}) ${r?`(else ${r})`:""})`,t.type)}function rt(e){return f(`(loop ${e})`)}function f(e="",t){return e=new String(e),t?typeof t=="string"&&(t=[t]):t=[],Object.assign(e,{type:t})}function I(e){return!S&&e[0]!=="_"||b[e]?(b[e]||={type:"f64"},f(`(global.get $${e})`,b[e].type)):h[e].static?f(`(global.get $${h[e].static})`,h[e].type):(h[e]||={type:"f64"},f(`(local.get $${e})`,h[e].type))}function z(e,t=""){return!S&&e[0]!=="_"||!Le&&b[e]?(b[e]||={type:t.type||"f64"},f(`(global.set $${e} ${t})`)):h[e].static?f(`(global.set $${h[e].static} ${t})`):(h[e]||={type:t.type||"f64"},f(`(local.set $${e} ${t})`))}function Te(e,t=""){return!S&&e[0]!=="_"||!Le&&b[e]?(b[e]||={type:t.type||"f64"},f(`(global.set $${e} ${t})(global.get $${e})`,t.type)):h[e].static?f(`(global.set $${h[e].static} ${t})(global.get $${h[e].static})`,h[e].type):(h[e]||={type:t.type||"f64"},f(`(local.tee $${e} ${t})`,t.type))}function N(e,...t){return T[e]||A(`Unknown function call '${e}'`),f(`(call $${e} ${t.join(" ")})`,T[e].type)}function R(e){et[e]||A("Unknown include `"+e+"`");let t=et[e],r=t.match(/\(result\s+([^\)]+)\)/i)?.[1].trim().split(/\s+/);T[e]||it(e,t,r)}function it(e,t,r){T[e]&&A(`Redefine func \`${e}\``),T[e]=new String(t),T[e].type=r}function lt(e,t){e.length<t.length&&(e.length=t.length);for(let r=0,i=t.length;r<i;r++)e[r]!==t[r]&&(e[r]="f64")}function Se(e,t){let r=t.findIndex((i,l)=>e.type[l]!=i);if(r<0)return e;if(r>=e.type.length-1){e=p(e);for(let i=e.type.length;i<t.length;i++)e+=`(${t[i]}.const nan)`;return f(e,t)}else A("Unimplemented return type mismatch")}function p(e){return e.type[0]==="f64"||e==de?e:e.startsWith("(i32.const")?f(e.replace("(i32.const","(f64.const"),"f64"):f(`(f64.convert_i32_s ${e})`,"f64")}function O(e){return e.type[0]==="i32"||e==de?e:f(`(i32.trunc_f64_s ${e})`,"i32")}function fe(e,t){if(t.type.length===1){if(e===1)return t;let r=`dup:${t.type[0]}`;return h[r]||={type:t.type[0]},f(`(local.set $${r} ${t})${`(local.get $${r})`.repeat(e)}`,Array(e).fill(t.type[0]))}if(t.type.length===e)return t;if(e<t.type.length)return f(t+"(drop)".repeat(t.type.length-e),t.type.slice(0,e));e>t.type.length&&A("Picking more members than available")}var nt=e=>e[0]===$||e[0]===y;var re,b,h,T,S,Le,ce,V,j,L,Q,q,de="%return%",At=2048,or=1024;function ft(e,t={}){typeof e=="string"&&(e=Fe(e)),e=Ue(e),console.log("compile",e);let r={imports:re,globals:b,locals:h,funcs:T,func:S,exports:ce,datas:V,mem:j,returns:L,defers:Q,depth:q};b={},h={},re=[],T={},ce={},L=null,Q=null,S=null,j=!1,q=0,V={};let i=s(e,!0).trim(),l="",n=e[0]===";"?e[e.length-1]:e;for(let o of ae(n))o.includes(":")||(ce[o]=b[o]||T[o]||A("Unknown export member `"+o+"'"));if(Object.keys(re).length){l+=`;;;;;;;;;;;;;;;;;;;;;;;;;;;; Imports
`;for(let o in re)l+=`(import "${re[o][0]}" "${re[o][1]}" ${re[o][2]})
`;l+=`
`}j!==!1&&(l+=`;;;;;;;;;;;;;;;;;;;;;;;;;;;; Memory
`,t.memory&&(l+=`(import "imports" "memory" (memory ${Math.ceil(j/65536)} ${At}))
`),l+=`(memory (export "memory") ${Math.ceil(j/65536)} ${At})
(global $__mem (mut i32) (i32.const ${j}))

`);for(let o in V){l+=`;;;;;;;;;;;;;;;;;;;;;;;;;;;; Data
`;break}for(let o in V)l+=`(data (i32.const ${o}) "${V[o]}")
`;for(let o in V){l+=`
`;break}for(let o in b)if(!o.includes(":")){l+=`;;;;;;;;;;;;;;;;;;;;;;;;;;;; Globals
`;break}for(let o in b)b[o].import||(l+=`(global $${o} (mut ${b[o].type}) ${b[o].init||`(${b[o].type}.const 0)`})
`);l+=`
`;for(let o in T){l+=`;;;;;;;;;;;;;;;;;;;;;;;;;;;; Functions
`;break}for(let o in T)l+=Ze(T[o])+`

`;i&&(l+=`;;;;;;;;;;;;;;;;;;;;;;;;;;;; Init
`+Ze(`(func $module:start
    ${Object.keys(h).map(o=>`(local $${o} ${h[o].type})`).join("")}
    ${i}
    (return))`)+`
(start $module:start)

`);for(let o in ce){l+=`;;;;;;;;;;;;;;;;;;;;;;;;;;;; Exports
`;break}for(let o in ce)l+=`(export "${o}" (${T[o]?"func":"global"} $${o}))
`;return console.groupCollapsed(),console.log(l),console.groupEnd(),{imports:re,globals:b,funcs:T,func:S,locals:h,exports:ce,datas:V,mem:j,returns:L,defers:Q,depth:q}=r,t?.target==="wasm"&&(l=Ye(l)),l}function s(e,t=!0){if(!e)return f();if(typeof e=="string")return h[e]||={type:"f64"},t?I(e):f();if(e.expr)return e.expr;if(e[0]in s)return e.expr=s[e[0]](e,t)||f();A(`Unknown operation ${e}`)}Object.assign(s,{[y]([,e],t){return t&&H.const(e)},[$]([,e],t){return t&&P.const(e)},'"'([,e],t){if(!t)return;V[j]=[...new TextEncoder().encode(e)];let r=N("arr.ref",j,e.length);return j+=e.length<<3,r},";"([,...e],t){let r=e.length-1,i=e.map((l,n)=>(Le=!n,s(l,n==r?t:!1)));return f(i.join(`
`),i[r]?.type)},","([,...e],t){let r=[];for(let i of e)r.push(s(i,t));return r=r.filter(Boolean),f(r.join(`
`),t&&r.flatMap(i=>i.type))},"("([,e,[,...t]],r){return T[e]||A("Unknown function call: "+e),r?N(e,t.map(i=>p(s(i)))):f(N(e,t.map(i=>p(s(i))))+"(drop)".repeat(!r&&T[e].type.length))},"[]"([,[,...e]],t){if(j||=0,!e.length)return t&&f(H.const(0),"f64");if(q++,function n(o){return o.every(a=>!a||typeof a[1]=="number"||a[0]==="["&&n(a.slice(1)))}(e)){let n=new Float64Array(e.map(a=>a?a[1]:0)),o=j;if(j+=n.length<<3,V[o]=yt(new Uint8Array(n.buffer)),q--,S){let a=`arr:${q}`;return h[a]={type:"i32"},R("malloc"),R("arr.ref"),f(z(a,N("malloc",P.const(n.length<<3)))+`(memory.copy ${I(a)} ${P.const(o)} ${P.const(n.length<<3)})`+N("arr.ref",I(a),P.const(n.length)),"f64")}else return R("arr.ref"),t&&N("arr.ref",P.const(o),P.const(n.length))}let r=`arr.start:${q}`,i=`arr.ptr:${q}`;h[r]={type:"i32"},h[i]={type:"i32"},R("malloc");let l=z(i,Te(r,N("malloc",P.const(or))));for(let n of e)if(n[0]===".."){let[,o,a]=n;if(a[1]===1/0&&A("Arrays cannot be constructed from right-open ranges"),o[1]===-1/0&&typeof a[1]=="number")a[1]<0&&A("Bad array range"),l+=z(i,P.add(I(i),P.const(a[1]<<3)));else{let d=`range.i:${q}`,x=`range.end:${q}`;h[d]=h[x]={type:"f64"},l+=z(d,p(s(o)))+z(x,p(s(a))),l+=rt(tt(H.lt(I(d),I(x)),H.store(I(i),I(d))+z(i,P.add(I(i),P.const(8)))+z(d,H.add(I(d),H.const(1)))+"(br 1)"))}}else n[0]==="|>"?l+=s(n):l+=H.store(P.sub(Te(i,P.add(I(i),P.const(8))),P.const(8)),p(s(n)));return R("malloc"),R("arr.ref"),l+=`(global.set $__mem ${I(i)})`,q--,t?f(l+N("arr.ref",`${I(r)} (i32.shr_u (i32.sub ${I(i)} ${I(r)}) ${P.const(3)})
`),"f64",{buf:!0}):f(l)},"["([,e,t],r){return R("arr.len"),R("i32.modwrap"),r?t?typeof t[1]=="number"&&t[1]>=0?H.load(P.add(`(i32.trunc_f64_u ${s(e)})`,P.const(t[1]<<3))):(R("arr.get"),N("arr.get",s(e),O(s(t)))):N("arr.len",s(e)):f(s(e,!1)+s(t,!1))},"="([,e,t],r){if(e[0]==="["){let[,i,l]=e;return R("arr.len"),R("arr.set"),R("arr.tee"),R("i32.modwrap"),N("arr."+(r?"tee":"set"),s(i),O(s(l)),p(s(t)))}if(e[0]==="("){let[,i,[,...l]]=e,n=t,o=[],a="",d=[],x;S&&A("Declaring local function `"+i+"`: not allowed"),T[i]&&A("Redefining function `"+i+"`: not allowed");let M=h;S=i,h={},L=Object.assign([],{type:[]}),Q=[],l=l.map(c=>{let g,K;return typeof c=="string"?g=c:c[0]==="="?([,g,K]=c,o.push(["?",["!=",g,g],["=",g,K]])):c[0]==="~"?([,g,K]=c,o.push(["~=",g,c[2]])):A("Unknown function argument"),h[g]={arg:!0,type:"f64"},d.push(`(param $${g} f64)`),g}),t.splice(1,0,...o),n=s(t),lt(L.type,n.type);let B=n.type;for(let c of L)Q.length?c=f(`${Se(c,L.type)}(br $func)`,L.type):c=f(`(return ${Se(c,L.type)})`,L.type),n=n.replace(de,c);n=Se(f(n,B),L.type),L.type.length&&(a=`(result ${L.type.join(" ")})`),Q.length&&(n=f(`(block $func ${a} ${n})`,n.type));let _;return it(i,`(func $${i} ${d.join("")} ${a}`+Object.entries(h).filter(([c,g])=>!g.arg&&!g.static).map(([c,g])=>`(local $${c} ${g.type})`).join(" ")+(n?`
${n}`:"")+(Q.length?`
${Q.join(" ")}`:"")+")",n.type),h=M,S=L=Q=null,_}if(e[0]==="*"){if([,e]=e,h[e]||={static:`${S}.${e}`,type:"f64"},nt(t)){b[`${S}.${e}`]={type:"f64",init:p(s(t))};return}return b[`${S}.${e}`]={type:"f64",init:f("(f64.const nan)")},s(["?",["!=",e,e],["=",e,t]],r)}if(typeof e=="string"){if(b[e]?.func&&A(`Redefining function '${e}' is not allowed`),!S&&nt(t)){b[e]={type:"f64",init:p(s(t))};return}h[e]||={type:"f64"};let i=s(t);return(r?Te:z)(e,p(i))}A(`Unknown assignment left value \`${ke(e)}\``)},"|>"([,e,t],r){if(e[0]===".."){q++;let[,i,l]=e,n=s(i),o=s(l),a="_",d=`idx:${q}`,x=`end:${q}`,M=s(t,r);h[a]=h[d]=h[x]={type:"f64"};let B=`;; |>:${q}
`+z(d,p(s(i)))+z(x,p(s(l)))+rt(tt(H.lt(I(d),I(x)),z(a,I(d))+M+z(d,H.add(I(d),H.const(1)))+"(br 1)"));return q--,f(B)}else console.log(e,t),A("loop over list: unimplemented");return q--,f(str,"f64",{dynamic:!0})},"-"([,e,t],r){if(!t){let n=s(e,r);return r?(n.type.length>1&&A("Group negation: unimplemented"),n.type[0]==="i32"?f(`(i32.sub (i32.const 0) ${n})`,"i32"):f(`(f64.neg ${n})`,"f64")):n}let i=s(e,r),l=s(t,r);return r?((i.type.length>1||l.type.length>1)&&A("Group subtraction: unimplemented"),i.type[0]==="i32"&&l.type[0]==="i32"?f(`(i32.sub ${i} ${l})`,"i32"):f(`(f64.sub ${p(i)} ${p(l)})`,"f64")):f(i+l)},"+"([,e,t],r){let i=s(e,r),l=s(t,r);return r?i.type[0]=="i32"&&l.type[0]=="i32"?f(`(i32.add ${i} ${l})`,"i32"):f(`(f64.add ${p(i)} ${p(l)})`,"f64"):f(i+l)},"*"([,e,t],r){if(!t)return h[e]||={static:`${S}.${e}`,type:"f64"},b[`${S}.${e}`]={type:"f64",init:f("(f64.const nan)")},s(e,r);let i=s(e,r),l=s(t,r);return r?((i.type.length>1||l.type.length>1)&&A("Complex group multiplication is not supported"),f(`(f64.mul ${p(i)} ${p(l)})`,"f64")):f(i+l)},"/"([,e,t],r){if(!t){S||A("Global return");let n=s(e);return L.push(n),L.type?lt(L.type,n.type):L.type=[...n.type],f(de,n.type)}let i=s(e,r),l=s(t,r);return r?f(`(f64.div ${p(i)} ${p(l)})`,"f64"):f(i+l)},"**"([,e,t],r){let i=s(e,r),l=s(t,r);return r?t[1]===.5?f(`(f64.sqrt ${p(i)})`,"f64"):(R("f64.pow"),N("f64.pow",p(i),p(l))):f(i+l)},"%"([,e,t],r){let i=s(e,r),l=s(t,r);return r?t[1]===1/0?i:(i.type[0]==="i32"&&l.type[0]==="i32"&&f(`(i32.rem_s ${i} ${l})`,"i32"),R("f64.rem"),N("f64.rem",p(i),p(l))):f(i+l)},"%%"([,e,t],r){let i=s(e,r),l=s(t,r);return r?i.type[0]==="i32"&&l.type[0]==="i32"?(R("i32.modwrap"),N("i32.modwrap",i,l)):(R("f64.modwrap"),R("f64.rem"),N("f64.modwrap",p(i),p(l))):f(i+l)},"++"([,e],t){if(!t)return s(["=",e,["+",e,[$,1]]],!1);if(e[0]==="[")return s(["-",["=",e,["+",e,[$,1]]],[$,1]]);typeof e!="string"&&A("Invalid left hand-side expression in prefix operation");let r=s(e);return f(`${r}${z(e,s(["+",e,[$,1]]))}`,r.type[0])},"--"([,e],t){if(!t)return s(["=",e,["-",e,[$,1]]],!1);if(e[0]==="[")return s(["+",["=",e,["-",e,[$,1]]],[$,1]]);typeof e!="string"&&A("Invalid left hand-side expression in prefix operation");let r=s(e);return f(`${r}${z(e,s(["-",e,[$,1]]))}`,r.type[0])},"!"([,e],t){let r=s(e,t);return t?(r.type.length>1&&A("Group inversion: unimplemented"),r.type[0]==="i32"?f(`(if (result i32) (i32.eqz ${r}) (then (i32.const 1)) (else (i32.const 0)))`,"i32"):f(`(if (result i32) (f64.eq ${r} (f64.const 0)) (then (i32.const 1)) (else (i32.const 0)))`,"i32")):f(r)},"|"([,e,t],r){let i=s(e,r),l=s(t,r);return r?t[1]===0?O(i):f(`(i32.or ${O(i)} ${O(l)})`,"i32"):f(i+l)},"&"([,e,t],r){let i=s(e,r),l=s(t,r);return r?f(`(i32.and ${O(i)} ${O(l)})`,"i32"):f(i+l)},"^"([,e,t],r){if(!t){let n=s(e,!1);Q||A("Bad defer"),Q.push(n);return}let i=s(e,r),l=s(t,r);return r?f(`(i32.xor ${O(i)} ${O(l)})`,"i32"):f(i+l)},"<<"([,e,t],r){let i=s(e,r),l=s(t,r);return r?f(`(i32.shl ${O(i)} ${O(l)})`,"i32"):f(i+l)},">>"([,e,t],r){let i=s(e,r),l=s(t,r);return r?f(`(i32.shr_s ${O(i)} ${O(l)})`,"i32"):f(i+l)},"<<<"([,e,t],r){let i=s(e,r),l=s(t,r);return r?f(`(i32.rotl ${O(i)} ${O(l)})`,"i32"):f(i+l)},">>>"([,e,t],r){let i=s(e,r),l=s(t,r);return r?f(`(i32.rotr ${O(i)} ${O(l)})`,"i32"):f(i+l)},"<"([,e,t],r){let i=s(e,r),l=s(t,r);return r?i.type[0]==="i32"&&l.type[0]==="i32"?f(`(i32.lt_s ${i} ${l})`,"i32"):f(`(f64.lt ${p(i)} ${p(l)})`,"i32"):f(i+l)},"<="([,e,t],r){let i=s(e,r),l=s(t,r);return r?i.type[0]==="i32"&&l.type[0]==="i32"?f(`(i32.le_s ${i} ${l})`,"i32"):f(`(f64.le ${p(i)} ${p(l)})`,"i32"):f(i+l)},">"([,e,t],r){let i=s(e,r),l=s(t,r);return r?i.type[0]==="i32"&&l.type[0]==="i32"?f(`(i32.gt_s ${i} ${l})`,"i32"):f(`(f64.gt ${p(i)} ${p(l)})`,"i32"):f(i+l)},">="([,e,t],r){let i=s(e,r),l=s(t,r);return r?i.type[0]==="i32"&&l.type[0]==="i32"?f(`(i32.ge_s ${i} ${l})`,"i32"):f(`(f64.ge ${p(i)} ${p(l)})`,"i32"):f(i+l)},"=="([,e,t],r){let i=s(e,r),l=s(t,r);return r?i.type[0]==="i32"&&l.type[0]==="i32"?f(`(i32.eq_s ${i} ${l})`,"i32"):f(`(f64.eq ${p(i)} ${p(l)})`,"i32"):f(i+l)},"!="([,e,t],r){let i=s(e,r),l=s(t,r);return r?i.type[0]==="i32"&&l.type[0]==="i32"?f(`(i32.ne_s ${i} ${l})`,"i32"):f(`(f64.ne ${p(i)} ${p(l)})`,"i32"):f(i+l)},"||"([,e,t],r){let i=s(e),l=s(t,r);return r?i.type[0]=="f64"?f(`${fe(2,i)}(if (param f64) (result f64) (f64.ne (f64.const 0)) (then) (else (drop) ${p(l)}))`,"f64"):l.type[0]=="i32"?f(`${fe(2,i)}(if (param i32) (result i32) (then) (else (drop) ${l}))`,"i32"):f(`${fe(2,i)}(if (param i32) (result f64) (then (f64.convert_i32_s)) (else (drop) ${l}))`,"f64"):f(`(if ${i.type[0]=="i32"?i:`(f64.ne ${i} (f64.const 0))`} (else ${l}))`)},"&&"([,e,t],r){let i=s(e),l=s(t,r);return r?i.type[0]=="f64"?f(`${fe(2,i)}(if (param f64) (result f64) (f64.ne (f64.const 0)) (then (drop) ${p(l)}))`,"f64"):l.type[0]=="i32"?f(`${fe(2,i)}(if (param i32) (result i32) (then (drop) ${l}))`,"i32"):f(`${fe(2,i)}(if (param i32) (result f64) (then (drop) ${l})) (else (f64.convert_i32_s))`,"f64"):f(`(if ${i.type[0]=="i32"?i:`(f64.ne ${i} (f64.const 0))`} (then ${l}))`)},"?"([,e,t],r){let i=s(e),l=s(t,r);return i.type.length>1&&A("Group condition is not supported yet."),r?f(`(if (result ${l.type[0]}) ${i.type[0]=="i32"?i:`(f64.ne ${i} (f64.const 0))`} (then ${l.type[0]==="i32"?l:p(l)} ) (else (${l.type[0]}.const 0)))`,l.type):f(`(if ${i.type[0]=="i32"?i:`(f64.ne ${i} (f64.const 0))`} (then ${l}))`)},"?:"([,e,t,r],i){let l=s(e),n=s(t,i),o=s(r,i);return l.type.length>1&&A("Group condition is not supported yet."),n.type[0]==="i32"&&o.type[0]==="i32"?f(`(if ${i?"(result i32)":""} ${l.type[0]=="i32"?l:`(f64.ne ${l} (f64.const 0))`} (then ${n} ) (else ${o}))`,i?"i32":[]):f(`(if ${i?"(result f64)":""} ${l.type[0]=="i32"?l:`(f64.ne ${l} (f64.const 0))`} (then ${p(n)} ) (else ${p(o)}))`,i?"f64":[])},"~"([,e,t],r){if(!t)return r&&f(`(i32.xor (i32.const -1) ${O(s(e))})`,"i32");t[0]!==".."&&A("Non-range passed as right side of clamp operator");let[,i,l]=t,n=s(e),o=i&&s(i,r),a=l&&s(l,r);return r?l?i?n.type=="i32"&&o.type=="i32"&&a.type=="i32"?(R("i32.smax"),R("i32.smin"),N("i32.smax",N("i32.smin",n,a),o)):f(`(f64.max (f64.min ${p(n)} ${p(a)}) ${p(o)})`,"f64"):n.type[0]==="i32"&&a.type[0]==="i32"?(R("i32.smin"),N("i32.min",n,a)):f(`(f64.min ${p(n)} ${p(a)})`,"f64"):n.type[0]==="i32"&&o.type[0]==="i32"?(R("i32.smax"),N("i32.max",n,o)):f(`(f64.max ${p(n)} ${p(o)})`,"f64"):f(o+a)}});var Vr=ft;export{ft as compile,Vr as default,Fe as parse,Ue as precompile};
