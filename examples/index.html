<!DOCTYPE html>

<script type="importmap">
  {
    "imports": {
      "tst": "../node_modules/tst/tst.js",
      "piezo": "../piezo.js",
      "ts-dedent": "../node_modules/ts-dedent/esm/index.js",
      "sprae": "../node_modules/sprae/sprae.js"
    }
  }
</script>

<body>
  <ul>
    <li :each="track, i in tracks">
      <a :href="'#' + track" :text="track"
         :onclick="() => loadExample(track)" />
    </li>
  </ul>
</body>

<script type="module">
  import sprae from 'sprae';

  let audioContext, processor
  async function init() {
    if (audioContext) return
    audioContext = new AudioContext();
    await audioContext.audioWorklet.addModule("processor.js");
    processor = new AudioWorkletNode(
      audioContext,
      "processor",
    );
    processor.connect(audioContext.destination);
  }

  // init UI
  sprae(document.body, {
    tracks: [
      'viznut-2011-09-18.z',
      'visy-2011-09-18.z',
      'tejeez-2011-09-18.z'
    ],
    async loadExample(url) {
      const [, code] = await Promise.all([init(), (await window.fetch(`/examples/${url}`)).text()])
      processor.port.postMessage(code)
    },
  });
</script>
